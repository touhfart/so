{% extends 'base.html' %}
{% load static %}

{% block title %}Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ø¹Ø§Ù… - {{ restaurant.name }}{% endblock %}

{% block content %}
<!-- Ø´Ø±ÙŠØ· Ø§Ù„Ø¨Ø­Ø« -->
<section class="search-section">
    <div class="search-box">
        <i class='bx bx-search'></i>
        <input 
            type="text" 
            id="search-input" 
            placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø·Ø¨Ù‚..." 
            value="{{ search_query }}"
            autocomplete="off"
        >
        {% if search_query %}
        <button class="search-box__clear" id="clear-search">
            <i class='bx bx-x'></i>
        </button>
        {% endif %}
    </div>
</section>

<!-- ØªØµÙÙŠØ© Ø§Ù„Ø£Ù‚Ø³Ø§Ù… -->
<nav class="categories">
    <div class="categories__container">
        <a href="{% url 'menu' %}" class="category-btn {% if not selected_category %}active{% endif %}">
            <i class='bx bx-food-menu'></i>
            <span>Ø§Ù„ÙƒÙ„</span>
        </a>
        {% for category in categories %}
        <a href="?category={{ category.id }}" class="category-btn {% if selected_category == category.id|stringformat:'s' %}active{% endif %}">
            <i class='bx {{ category.icon }}'></i>
            <span>{{ category.name }}</span>
        </a>
        {% endfor %}
    </div>
</nav>

<!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª -->
<section class="menu-section">
    {% if items %}
    <div class="menu-grid">
        {% for item in items %}
        <article class="card" data-id="{{ item.id }}">
            <div class="card__image-container">
                <img 
                    src="{{ item.image.url }}" 
                    alt="{{ item.name }}" 
                    class="card__image"
                    loading="lazy"
                >
                {% if item.is_featured %}
                <span class="card__badge card__badge--featured">Ù…Ù…ÙŠØ²</span>
                {% endif %}
                {% if item.is_spicy %}
                <span class="card__badge card__badge--spicy">ğŸŒ¶ï¸</span>
                {% endif %}
                {% if item.is_vegetarian %}
                <span class="card__badge card__badge--veg">ğŸ¥¬</span>
                {% endif %}
            </div>
            
            <div class="card__content">
                <h3 class="card__title">{{ item.name }}</h3>
                {% if item.description %}
                <p class="card__desc">{{ item.description|truncatewords:10 }}</p>
                {% endif %}
                <div class="card__price">{{ item.price }} Ø¯Ø±Ù‡Ù…</div>
            </div>
            
            <div class="card__actions">
                <a href="{% url 'order_whatsapp' item.id %}" class="card__btn card__btn--whatsapp" title="Ø·Ù„Ø¨ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨">
                    <i class='bx bxl-whatsapp'></i>
                </a>
                <button class="card__btn card__btn--cart" data-id="{{ item.id }}" title="Ø£Ø¶Ù Ù„Ù„Ø³Ù„Ø©">
                    <i class='bx bx-cart-add'></i>
                    <span>Ø£Ø¶Ù</span>
                </button>
            </div>
            
            <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„ÙƒÙ…ÙŠØ© (ØªØ¸Ù‡Ø± Ø¨Ø¹Ø¯ Ø§Ù„Ø¥Ø¶Ø§ÙØ©) -->
            <div class="card__quantity hidden" id="qty-{{ item.id }}">
                <button class="qty-btn qty-btn--minus" data-id="{{ item.id }}">
                    <i class='bx bx-minus'></i>
                </button>
                <span class="qty-value" id="qty-value-{{ item.id }}">0</span>
                <button class="qty-btn qty-btn--plus" data-id="{{ item.id }}">
                    <i class='bx bx-plus'></i>
                </button>
            </div>
        </article>
        {% endfor %}
    </div>
    {% else %}
    <!-- Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ -->
    <div class="empty-state">
        <i class='bx bx-search-alt'></i>
        <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù…Ø·Ø§Ø¨Ù‚Ø©</p>
        <a href="{% url 'menu' %}" class="btn btn--primary">Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„</a>
    </div>
    {% endif %}
</section>
{% endblock %}

{% block extra_js %}
<script>
// Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ù…Ø¨Ø§Ø´Ø±
const searchInput = document.getElementById('search-input');
let searchTimeout;

searchInput?.addEventListener('input', (e) => {
    clearTimeout(searchTimeout);
    searchTimeout = setTimeout(() => {
        const query = e.target.value.trim();
        const url = new URL(window.location);
        if (query) {
            url.searchParams.set('search', query);
        } else {
            url.searchParams.delete('search');
        }
        window.location = url;
    }, 500);
});

// Ù…Ø³Ø­ Ø§Ù„Ø¨Ø­Ø«
document.getElementById('clear-search')?.addEventListener('click', () => {
    const url = new URL(window.location);
    url.searchParams.delete('search');
    window.location = url;
});
</script>
{% endblock %}
